<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Library</title>
  <link rel="stylesheet" href="css/styles.css">
  <script type="importmap">
  {
    "imports": {
      "dexie": "https://esm.sh/dexie@4",
      "jszip": "https://esm.sh/jszip@3"
    }
  }
  </script>
</head>
<body>
  <header class="app-header">
    <div class="header-inner">
      <div class="header-brand">
        <svg class="brand-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <h1 class="app-title">Library <span class="app-version">0.6</span></h1>
      </div>
      <button class="btn btn-primary" id="import-btn">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        Import
      </button>
    </div>
  </header>

  <main class="main-content" id="main">
    <div id="empty-state" class="empty-state">
      <div class="empty-illustration">
        <svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="14" y="62" width="68" height="10" rx="3" fill="#e2e8f0"/>
          <rect x="18" y="46" width="60" height="16" rx="3" fill="#cbd5e1"/>
          <rect x="22" y="30" width="52" height="16" rx="3" fill="#94a3b8"/>
          <line x1="40" y1="30" x2="40" y2="72" stroke="#64748b" stroke-width="1.5"/>
        </svg>
      </div>
      <h2 class="empty-title">Your library is empty</h2>
      <p class="empty-subtitle">Import EPUB files to start your digital library</p>
      <button class="btn btn-primary btn-lg" id="empty-import-btn">Import Books</button>
      <p class="drop-hint">or drop EPUB files anywhere on this page</p>
    </div>

    <div id="book-grid" class="book-grid hidden"></div>
  </main>

  <!-- ── Reader view ─────────────────────────────────────────── -->
  <section id="reader-view" class="reader-view hidden" aria-label="Book reader">

    <header class="reader-header">
      <button class="reader-back-btn" id="reader-back-btn" aria-label="Back to library">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        Library
      </button>
      <div class="reader-header-title" id="reader-book-title"></div>
      <div class="reader-header-spacer" aria-hidden="true"></div>
    </header>

    <div class="reader-body">
      <div class="reader-cover" id="reader-cover"></div>

      <div class="reader-info">
        <div class="reader-chapter-title" id="reader-chapter-title"></div>
        <p class="reader-sentence" id="reader-sentence"></p>
      </div>

      <div class="reader-progress-wrap">
        <div class="reader-progress-track" role="progressbar" aria-label="Chapter progress">
          <div class="reader-progress-fill" id="reader-progress-fill"></div>
        </div>
        <div class="reader-progress-label" id="reader-progress-label"></div>
      </div>
    </div>

    <div class="reader-bottom">

      <!-- Settings panel — slides up when open -->
      <div id="reader-settings-panel" class="reader-settings-panel">
        <div class="settings-panel-header">
          <span class="settings-panel-title">Settings</span>
          <button id="settings-close-btn" class="settings-close-btn" aria-label="Close settings">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="settings-body">
          <label class="settings-row">
            <span class="settings-label">Voice</span>
            <select id="settings-voice" class="settings-select"></select>
          </label>
          <label class="settings-row">
            <span class="settings-label">Speed</span>
            <div class="settings-slider-wrap">
              <span class="settings-slider-min">0.5×</span>
              <input type="range" id="settings-rate" min="0.5" max="2" step="0.1" value="1">
              <span class="settings-slider-max">2×</span>
              <span class="settings-slider-val" id="settings-rate-val">1.0×</span>
            </div>
          </label>
          <label class="settings-row">
            <span class="settings-label">Pitch</span>
            <div class="settings-slider-wrap">
              <span class="settings-slider-min">low</span>
              <input type="range" id="settings-pitch" min="0.5" max="2" step="0.1" value="1">
              <span class="settings-slider-max">high</span>
              <span class="settings-slider-val" id="settings-pitch-val">1.0</span>
            </div>
          </label>
        </div>
      </div>

      <!-- Bookmarks panel — slides up when open -->
      <div id="reader-bookmarks-panel" class="reader-bookmarks-panel">
        <div class="bookmarks-panel-header">
          <span class="bookmarks-panel-title">Bookmarks</span>
          <div class="bookmarks-panel-actions">
            <button id="bookmarks-add-btn" class="bookmarks-add-btn" disabled>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
              </svg>
              Save position
            </button>
            <button id="bookmarks-close-btn" class="bookmarks-close-btn" aria-label="Close bookmarks">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>
        <div id="bookmarks-list" class="bookmarks-list"></div>
        <p id="bookmarks-empty" class="bookmarks-empty">No bookmarks yet. Press "Save position" to mark where you are.</p>
      </div>

      <div class="reader-controls" role="group" aria-label="Playback controls">
        <div class="reader-controls-main">
          <button class="ctrl-btn" id="ctrl-restart" title="Restart book" aria-label="Restart book" disabled>
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
            </svg>
          </button>

          <button class="ctrl-btn ctrl-btn-play" id="ctrl-play" title="Play" aria-label="Play" disabled>
            <!-- icon injected by reader.js -->
            <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
          </button>

          <button class="ctrl-btn" id="ctrl-forward" title="Next chapter" aria-label="Next chapter" disabled>
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polygon points="5 4 15 12 5 20 5 4" fill="currentColor" stroke="none"/>
              <line x1="19" y1="5" x2="19" y2="19"/>
            </svg>
          </button>
        </div>

        <button class="ctrl-btn ctrl-btn-side ctrl-btn-side-left" id="ctrl-settings" title="Settings" aria-label="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </button>

        <button class="ctrl-btn ctrl-btn-side ctrl-btn-side-right" id="ctrl-bookmarks" title="Bookmarks" aria-label="Bookmarks">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
          </svg>
        </button>
      </div>

    </div>

  </section>

  <!-- Full-page drag overlay -->
  <div id="drag-overlay" class="drag-overlay hidden" aria-hidden="true">
    <div class="drag-overlay-inner">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
      <p>Drop EPUB files to import</p>
    </div>
  </div>

  <!-- Import progress dialog -->
  <div id="import-overlay" class="import-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="import-status">
    <div class="import-dialog">
      <p id="import-status" class="import-status-text">Importing…</p>
      <div class="progress-track">
        <div class="progress-bar" id="import-progress-bar"></div>
      </div>
      <p id="import-detail" class="import-detail"></p>
    </div>
  </div>

  <input type="file" id="file-input" accept=".epub" multiple hidden>
  <div id="toast-container" class="toast-container" aria-live="polite"></div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
